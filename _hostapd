apt install -y iw hostapd bridge-utils

echo enp0s8: \\4{enp0s8} >> /etc/issue
echo br0: \\4{br0} >> /etc/issue
echo "" >> /etc/issue

mv hostapd /etc/default/hostapd
mv hostapd.conf /etc/hostapd.conf
mv interfaces /etc/network/interfaces
mv grub /etc/default/grub

systemctl enable systemd-networkd
systemctl unmask hostapd
systemctl enable hostapd

cd
ln -s /etc/network/interfaces
ln -s /etc/hostapd.conf

update-grub2

passwd -d root && getent passwd {1000..1001} | awk -F: '{ system("userdel -r " $1) }'

iptables -F
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -A INPUT -mstate --state ESTABLISHED -j ACCEPT
iptables-save > /etc/firewall

echo "#! /bin/bash" > /etc/network/if-pre-up.d/iptables
echo "" >> /etc/network/if-pre-up.d/iptables
echo "iptables-restore < /etc/firewall" >> /etc/network/if-pre-up.d/iptables

chmod +x /etc/network/if-pre-up.d/iptables

function eof {
  cd;
  rm -rf ~/hostapd;
  systemctl reboot;
}

trap eof EXIT
